"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.convertBridgeRoutesToServerRoutes = void 0;
const types_1 = require("./types");
const core_1 = require("../core");
const method_1 = require("./method");
const serverRoutes = {};
const convertBridgeRoutesToServerRoutes = (routes, prefix, hasFormidable) => {
    for (const [key, value] of Object.entries(routes)) {
        if (!value)
            continue;
        else if ((0, method_1.isBridgeMethod)(value)) {
            serverRoutes[`${prefix}/${key}`] = value.methods;
            Object.values(value.methods).forEach((handler) => {
                if (handler.config.filesConfig && !hasFormidable)
                    throw new Error(`You need to install formidable and to give it to Bridge in order to use files.`);
            });
        }
        else if ((0, core_1.isBridgeHandler)(value)) {
            serverRoutes[`${prefix}/${key}`] = { POST: value };
            if (value.config.filesConfig && !hasFormidable)
                throw new Error(`You need to install formidable and pass it to the initBridge function in order to use files.
          \nCheck the documentation: https://bridge.codes/docs/file \n`);
        }
        else if ((0, types_1.isBridgeRoutes)(value))
            (0, exports.convertBridgeRoutesToServerRoutes)(value, `${prefix}/${key}`, hasFormidable);
    }
    return serverRoutes;
};
exports.convertBridgeRoutesToServerRoutes = convertBridgeRoutesToServerRoutes;
//# sourceMappingURL=convert.js.map